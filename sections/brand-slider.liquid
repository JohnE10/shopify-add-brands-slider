{% schema %}
{
  "name": "Brand Slider",
  "settings": [
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay Slider",
      "default": true
    },
    {
      "type": "number",
      "id": "autoplay_speed",
      "label": "Autoplay Speed (ms)",
      "default": 3000
    }
  ],
  "blocks": [
    {
      "type": "image_block",
      "name": "Brand Image",
      "settings": [
        {
          "id": "image",
          "type": "image_picker",
          "label": "Brand Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Brand Slider",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<div class="brand-slider-section">
  <div class="brand-slider-container">
    <div class="brand-slider">
      <div class="brand-slider-wrapper">
        {% for block in section.blocks %}
          <div class="brand-slide">
            {% if block.settings.image %}
              <img src="{{ block.settings.image | image_url: width:150 }}" alt="Brand Image">
            {% else %}
              <div class="placeholder">No Image</div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<style>
  .brand-slider-section {
    width: 100%;
  }

  .brand-slider-container {
    max-width: 1200px;
    margin: 0 auto;
    overflow: hidden;
  }

  .brand-slider {
    width: 100%;
    overflow: hidden;
  }

  .brand-slider-wrapper {
    display: flex;
  }

  .brand-slide {
    flex: 0 0 150px; /* Each slide is 150px wide */
  }

  .brand-slide img {
    width: 150px; /* Image width */
    height: auto; /* Maintain aspect ratio */
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sliderWrapper = document.querySelector('.brand-slider-wrapper');
    const slides = document.querySelectorAll('.brand-slide');
    const slideWidth = 150; // Each slide is 150px wide
    const autoplaySpeed = {{ section.settings.autoplay_speed }};
    let currentPosition = 0;

    // Clone the slides for seamless looping
    const totalSlides = slides.length;
    for (let i = 0; i < totalSlides; i++) {
      sliderWrapper.appendChild(slides[i].cloneNode(true));
    }

    // Function to move the slider
    function moveSlider() {
      currentPosition -= 1; // Adjust the scroll speed here
      sliderWrapper.style.transition = `transform ${autoplaySpeed}ms linear`;
      sliderWrapper.style.transform = `translateX(${currentPosition}px)`;

      // Check if we need to reset to the beginning
      if (Math.abs(currentPosition) >= slideWidth * totalSlides) {
        currentPosition = 0;
        // Disable transition temporarily to jump back to start position
        sliderWrapper.style.transition = 'none';
        sliderWrapper.style.transform = `translateX(${currentPosition}px)`;
        // Re-enable transition to resume smooth sliding
        setTimeout(() => {
          sliderWrapper.style.transition = `transform ${autoplaySpeed}ms linear`;
        }, 50);
      }
    }

    // Start autoplay initially
    setInterval(moveSlider, 10); // Adjust the interval for smoother movement
  });
</script>
